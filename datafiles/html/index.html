<html>
  <head>
    <meta charset="utf-8" />
    <title>gotwebfe</title>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="go-tibia-192.png">
    <script src="wasm_exec.js"></script>
    <script type="text/javascript">
      if (navigator.serviceWorker != null) {
          navigator.serviceWorker.register('/sw.js', {'scope': '/'})
              .then(function(registration) {
                  console.log('Registered events at scope: ', registration.scope);
              });
      }
    </script>
    <script>
      // FIXME: wait until serviceworker is available, otherwise both sw
      // and wasm will be fetching the file.

      if (WebAssembly) {
        // WebAssembly.instantiateStreaming is not currently available in Safari
        if (WebAssembly && !WebAssembly.instantiateStreaming) { // polyfill
          WebAssembly.instantiateStreaming = async (resp, importObject) => {
            const source = await (await resp).arrayBuffer();
            return await WebAssembly.instantiate(source, importObject);
          };
        }

        const go = new Go();
        WebAssembly.instantiateStreaming(
          fetch('main.wasm'),
          go.importObject
        ).then(result => {
          go.run(result.instance)
        })
      } else {
         console.log("WebAssembly is not supported in your browser")
      }


    </script>
  </head>
  <body>

    <h1>Sprites</h1>

    <p>
      <input id="sprite_id" placeholder="sprite id"><button onclick="showSpr(parseInt(document.getElementById('sprite_id').value));">show</button>
    </p>
    <div id="sprites">
    </div>

    <h1>Map</h1>
    <p>
      <button onclick="loaderPromise().then((val) => console.log('loading complete'))">loaderPromise</button>
      <button onclick="loaderPromise().then(showMap, (val) => console.error('loading failed: ' + val))">show map</button>
      <button onclick="loaderPromise().then((val) => showMap())">show map 2</button>
    </p>
    <div id="map">
    </div>

    <h1>Maintenance</h1>
    <p>
      <button onclick="navigator.serviceWorker.getRegistrations().then(function(registrations) { for(let registration of registrations) {  registration.unregister()} })">clear service worker</button>
    </p>

  </body>
  
</html>

